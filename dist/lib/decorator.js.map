{"version":3,"sources":["../../server/lib/decorator.js"],"names":["isArray","_","c","symbolPrefix","routerMap","Route","app","apiPath","router","Router","glob","sync","__dirname","forEach","require","conf","middleware","middlewares","prefix","target","normalizePath","routerPath","path","method","use","routes","allowedMethods","controller","prototype","startsWith","key","descripor","set","get","post","put","del","all"],"mappings":"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","file":"decorator.js","sourcesContent":["import Router from 'koa-router'\r\nimport glob from 'glob'\r\nimport { resolve, normalize } from 'path'\r\nimport _ from 'lodash'\r\nconst isArray = c => _.isArray(c) ? c : [c]\r\nconst symbolPrefix = Symbol()\r\nconst routerMap = new Map()\r\nexport class Route\r\n{\r\n    constructor (app,apiPath)\r\n    {\r\n        this.app = app\r\n        this.apiPath = apiPath\r\n        this.router = new Router()\r\n    }\r\n\r\n    init ()\r\n    {\r\n        glob.sync(resolve(__dirname,this.apiPath,'./**/*.js')).forEach(require)\r\n        for(let [conf, middleware] of routerMap)\r\n        {\r\n            const middlewares=isArray(middleware)\r\n            const prefix = conf.target[symbolPrefix]\r\n            if(prefix) prefix = normalizePath(prefix)\r\n            const routerPath=prefix + conf.path\r\n            this.router[conf.method](routerPath,...middlewares)\r\n        }\r\n        this.app.use(this.router.routes())\r\n        this.app.use(this.router.allowedMethods())\r\n    }\r\n}\r\n\r\n\r\nexport const controller = path => target => (target.prototype[symbolPrefix] = path)\r\nexport const  normalizePath = path => path.startsWith('/') ? path : `/${path}`\r\nexport const router = conf => (target,key,descripor) => {\r\n    conf.path = normalizePath(conf.path)\r\n    routerMap.set({\r\n        target:target,\r\n        ...conf\r\n    },target[key])\r\n}\r\nexport const get = path => router({\r\n    method: 'get',\r\n    path: path\r\n})\r\nexport const post = path => router({\r\n    method: 'post',\r\n    path: path\r\n})\r\nexport const put = path => router({\r\n    method: 'put',\r\n    path: path\r\n})\r\nexport const del = path => router({\r\n    method: 'del',\r\n    path: path\r\n})\r\nexport const use = path => router({\r\n    method: 'use',\r\n    path: path\r\n})\r\nexport const all = path => router({\r\n    method: 'all',\r\n    path: path\r\n})\r\n\r\n// export {\r\n//     get,\r\n//     post,\r\n//     put,\r\n//     del,\r\n//     use,\r\n//     all\r\n// }\r\n"]}