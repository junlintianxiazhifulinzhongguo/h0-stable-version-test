{"version":3,"sources":["../../server/database/init.js"],"names":["mongoose","Promise","global","connect","maxConnectTimes","resolve","reject","process","env","set","mongodb","db","useNewUrlParser","connection","on","Error","err","once","console","log"],"mappings":";;;;;;;AAAA;;;;AACA;;AAEA;;;;AACAA,mBAASC,OAAT,GAAiBC,OAAOD,OAAxB;AACA,IAAME,UAAU,SAAVA,OAAU,GAAM;AACd,QAAIC,kBAAgB,CAApB;AACA,WAAO,IAAIH,OAAJ,CAAY,UAACI,OAAD,EAASC,MAAT,EAAkB;AACjC,YAAGC,QAAQC,GAAR,IAAa,YAAhB,EACA;AACIR,+BAASS,GAAT,CAAa,OAAb,EAAqB,IAArB;AACH;AACDT,2BAASG,OAAT,CAAiBO,eAAQC,EAAzB,EAA6B,EAACC,iBAAiB,IAAlB,EAA7B;AACAZ,2BAASa,UAAT,CAAoBC,EAApB,CAAuB,cAAvB,EAAsC,YAAI;AACtCV;AACA,gBAAGA,kBAAgB,CAAnB,EACA;AACIJ,mCAASG,OAAT,CAAiBO,eAAQC,EAAzB,EAA6B,EAACC,iBAAiB,IAAlB,EAA7B;AACH,aAHD,MAKA;AACI,sBAAM,IAAIG,KAAJ,CAAU,WAAV,CAAN;AACH;AACJ,SAVD;AAWAf,2BAASa,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAA+B,UAACE,GAAD,EAAO;AAClCZ;AACA,gBAAGA,kBAAgB,CAAnB,EACA;AACIJ,mCAASG,OAAT,CAAiBO,eAAQC,EAAzB,EAA6B,EAACC,iBAAiB,IAAlB,EAA7B;AACH,aAHD,MAKA;AACI,sBAAM,IAAIG,KAAJ,CAAU,WAAV,CAAN;AACH;AACJ,SAVD;AAWAf,2BAASa,UAAT,CAAoBI,IAApB,CAAyB,MAAzB,EAAgC,YAAI;AAChCb,8BAAgB,CAAhB;AACAC,oBAAQ,MAAR;AACAa,oBAAQC,GAAR,CAAY,+BAAZ;AACH,SAJD;AAKH,KAjCM,CAAP;AAkCP,CApCD;QA0CIhB,O,GAAAA,O","file":"init.js","sourcesContent":["import mongoose from 'mongoose' \r\nimport { mongodb } from '../config/index'\r\n// import glob from 'glob'\r\nimport { resolve } from 'path'\r\nmongoose.Promise=global.Promise\r\nconst connect = () => {\r\n        let maxConnectTimes=0\r\n        return new Promise((resolve,reject)=>{\r\n            if(process.env!='production')\r\n            {\r\n                mongoose.set('debug',true)\r\n            }\r\n            mongoose.connect(mongodb.db, {useNewUrlParser: true})\r\n            mongoose.connection.on('disconnected',()=>{\r\n                maxConnectTimes++\r\n                if(maxConnectTimes<5)\r\n                {\r\n                    mongoose.connect(mongodb.db, {useNewUrlParser: true})\r\n                }\r\n                else\r\n                {\r\n                    throw new Error('数据库挂了，请维修')\r\n                }\r\n            })\r\n            mongoose.connection.on('error',(err)=>{\r\n                maxConnectTimes++\r\n                if(maxConnectTimes<5)\r\n                {\r\n                    mongoose.connect(mongodb.db, {useNewUrlParser: true})\r\n                }\r\n                else\r\n                {\r\n                    throw new Error('数据库挂了，请维修')\r\n                }\r\n            })\r\n            mongoose.connection.once('open',()=>{\r\n                maxConnectTimes=0\r\n                resolve('连接成功')\r\n                console.log('Mongodb connected succsefully')\r\n            })\r\n        })       \r\n}\r\n    // iniSchema:()=>{\r\n    //     glob.sync(resolve(__dirname, './schema', '**/*.js')).forEach(require)              \r\n    // }\r\n\r\nexport {\r\n    connect\r\n}"]}